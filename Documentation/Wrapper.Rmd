---
title: "Model wrapper function"
author: "Lorenzo Menichetti"
date: "`r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_depth: 3
    toc_float: true
    number_sections: true
    theme: flatly
    highlight: tango
    code_folding: show
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(tidyverse)
library(knitr)
library(kableExtra)
```

# Unified SOC Model Comparison Wrapper

## Overview

Wrapper function to run multiple SOC models on the same input data for structural comparison.

Supported models:
- Yasso07
- Yasso15
- Yasso20
- RothC
- Q-model

```r
run_soc_models(
  input_df,
  site_row = NULL,
  models = c("yasso07", "yasso15", "yasso20", "rothc", "q_model"),
  spinup_years = NULL,
  rothc_annual_stat = c("eoy","mean")
)
```

## Model comparison

```{r model-comparison-table}
model_comp <- tibble::tribble(
  ~Model, ~Timestep, ~Pools, ~Climate_forcing, ~Initialization,
  "Yasso07", "Annual", "AWENH", "Annual mean + amplitude T, annual P", "Analytical steady state",
  "Yasso15", "Annual", "AWENH", "Annual mean + amplitude T, annual P", "Analytical steady state",
  "Yasso20", "Annual", "AWENH", "Monthly T, annual P", "Analytical steady state",
  "RothC", "Monthly", "DPM/RPM/BIO/HUM/IOM", "Monthly T, P, evap + clay", "Analytical steady state",
  "Q-model", "Annual", "Quality spectrum", "Annual climate + species", "Hybrid analytical + numeric"
)

kable(model_comp) %>%
  kable_styling(full_width = FALSE)
```

## Initialization approach

```{r init-comparison-table}
init_comp <- tibble::tribble(
  ~Model, ~Approach, ~Notes,
  "Yasso07", "Analytical steady state", "Solved from A x + b = 0 using mean climate and inputs",
  "Yasso15", "Analytical steady state", "Solved per litter type, summed",
  "Yasso20", "Analytical steady state", "Monthly temperature response, annual precipitation",
  "RothC", "Analytical steady state", "Closed-form solution for linear pools",
  "Q-model", "Hybrid", "Analytical approximation plus short numerical spinup"
)

kable(init_comp) %>%
  kable_styling(full_width = FALSE)
```

## Key assumptions

1. Total carbon inputs preserved across mappings.
2. Same underlying monthly climate data used for all models.
3. Annual summaries used for comparison (RothC aggregated).
4. Structural differences between models intentionally retained.
